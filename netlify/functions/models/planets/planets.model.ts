import { parse } from "csv-parse";
import fs from "fs";
import path from "path";
import { PlanetDataType } from "../../types/planetTypes";
// import Promise from 'stream/promises'

export const habitablePlanets: PlanetDataType[] = [];

export const staticHabitablePLanets: PlanetDataType[] = [
  {
    kepid: 11768142,
    kepoi_name: "K02626.01",
    kepler_name: "Kepler-1652 b",
    koi_disposition: "CONFIRMED",
    koi_pdisposition: "CANDIDATE",
    koi_score: 0.999,
    koi_fpflag_nt: 0,
    koi_fpflag_ss: 0,
    koi_fpflag_co: 0,
    koi_fpflag_ec: 0,
    koi_period: 38.0970717,
    koi_period_err1: 3.079e-4,
    koi_period_err2: -3.079e-4,
    koi_time0bk: 140.00353,
    koi_time0bk_err1: 6.59e-3,
    koi_time0bk_err2: -6.59e-3,
    koi_impact: 0.953,
    koi_impact_err1: 0.019,
    koi_impact_err2: -0.688,
    koi_duration: 4.307,
    koi_duration_err1: 0.21,
    koi_duration_err2: -0.21,
    koi_depth: "9.1330e+02",
    koi_depth_err1: "5.910e+01",
    koi_depth_err2: "-5.910e+01",
    koi_prad: 1.58,
    koi_prad_err1: 2.0e-1,
    koi_prad_err2: "-2.100e-01",
    koi_teq: "242.0",
    koi_teq_err1: "",
    koi_teq_err2: "",
    koi_insol: 0.81,
    koi_insol_err1: "0.30",
    koi_insol_err2: "-0.25",
    koi_model_snr: "17.00",
    koi_tce_plnt_num: "1",
    koi_tce_delivname: "q1_q17_dr25_tce",
    koi_steff: "3554.00",
    koi_steff_err1: "71.00",
    koi_steff_err2: "-80.00",
    koi_slogg: "4.867",
    koi_slogg_err1: "0.055",
    koi_slogg_err2: "-0.055",
    koi_srad: "0.3980",
    koi_srad_err1: "0.0490",
    koi_srad_err2: "-0.0540",
    ra: "294.366090",
    dec: "49.915058",
    koi_kepmag: "15.931",
  },
  {
    kepid: 3642335,
    kepoi_name: "K03010.01",
    kepler_name: "Kepler-1410 b",
    koi_disposition: "CONFIRMED",
    koi_pdisposition: "CANDIDATE",
    koi_score: 0.996,
    koi_fpflag_nt: 0,
    koi_fpflag_ss: 0,
    koi_fpflag_co: 0,
    koi_fpflag_ec: 0,
    koi_period: 60.8660974,
    koi_period_err1: 6.497e-4,
    koi_period_err2: -6.497e-4,
    koi_time0bk: 179.28674,
    koi_time0bk_err1: 7.87e-3,
    koi_time0bk_err2: -7.87e-3,
    koi_impact: 0.004,
    koi_impact_err1: 0.463,
    koi_impact_err2: -0.004,
    koi_duration: 4.397,
    koi_duration_err1: 0.238,
    koi_duration_err2: -0.238,
    koi_depth: "7.1430e+02",
    koi_depth_err1: "5.370e+01",
    koi_depth_err2: "-5.370e+01",
    koi_prad: 1.39,
    koi_prad_err1: 7.0e-2,
    koi_prad_err2: "-1.000e-01",
    koi_teq: "244.0",
    koi_teq_err1: "",
    koi_teq_err2: "",
    koi_insol: 0.84,
    koi_insol_err1: "0.17",
    koi_insol_err2: "-0.16",
    koi_model_snr: "15.40",
    koi_tce_plnt_num: "1",
    koi_tce_delivname: "q1_q17_dr25_tce",
    koi_steff: "3808.00",
    koi_steff_err1: "69.00",
    koi_steff_err2: "-76.00",
    koi_slogg: "4.734",
    koi_slogg_err1: "0.033",
    koi_slogg_err2: "-0.027",
    koi_srad: "0.5220",
    koi_srad_err1: "0.0280",
    koi_srad_err2: "-0.0350",
    ra: "290.510190",
    dec: "38.743542",
    koi_kepmag: "15.757",
  },
  {
    kepid: 11497958,
    kepoi_name: "K01422.04",
    kepler_name: "Kepler-296 f",
    koi_disposition: "CONFIRMED",
    koi_pdisposition: "CANDIDATE",
    koi_score: 0.927,
    koi_fpflag_nt: 0,
    koi_fpflag_ss: 0,
    koi_fpflag_co: 0,
    koi_fpflag_ec: 0,
    koi_period: 63.3354719,
    koi_period_err1: 9.27e-4,
    koi_period_err2: -9.27e-4,
    koi_time0bk: 162.6161,
    koi_time0bk_err1: 1.11e-2,
    koi_time0bk_err2: -1.11e-2,
    koi_impact: 0.029,
    koi_impact_err1: 0.422,
    koi_impact_err2: -0.029,
    koi_duration: 3.651,
    koi_duration_err1: 0.251,
    koi_duration_err2: -0.251,
    koi_depth: "9.8300e+02",
    koi_depth_err1: "8.380e+01",
    koi_depth_err2: "-8.380e+01",
    koi_prad: 1.18,
    koi_prad_err1: 1.5e-1,
    koi_prad_err2: "-1.800e-01",
    koi_teq: "202.0",
    koi_teq_err1: "",
    koi_teq_err2: "",
    koi_insol: 0.39,
    koi_insol_err1: "0.15",
    koi_insol_err2: "-0.13",
    koi_model_snr: "13.00",
    koi_tce_plnt_num: "5",
    koi_tce_delivname: "q1_q17_dr25_tce",
    koi_steff: "3526.00",
    koi_steff_err1: "71.00",
    koi_steff_err2: "-78.00",
    koi_slogg: "4.866",
    koi_slogg_err1: "0.066",
    koi_slogg_err2: "-0.044",
    koi_srad: "0.3830",
    koi_srad_err1: "0.0480",
    koi_srad_err2: "-0.0580",
    ra: "286.540010",
    dec: "49.437328",
    koi_kepmag: "15.921",
  },
  {
    kepid: 4138008,
    kepoi_name: "K04742.01",
    kepler_name: "Kepler-442 b",
    koi_disposition: "CONFIRMED",
    koi_pdisposition: "CANDIDATE",
    koi_score: 0.993,
    koi_fpflag_nt: 0,
    koi_fpflag_ss: 0,
    koi_fpflag_co: 0,
    koi_fpflag_ec: 0,
    koi_period: 112.303136,
    koi_period_err1: 1.722e-3,
    koi_period_err2: -1.722e-3,
    koi_time0bk: 230.4383,
    koi_time0bk_err1: 1.25e-2,
    koi_time0bk_err2: -1.25e-2,
    koi_impact: 0.248,
    koi_impact_err1: 0.191,
    koi_impact_err2: -0.248,
    koi_duration: 5.869,
    koi_duration_err1: 0.362,
    koi_duration_err2: -0.362,
    koi_depth: "5.0210e+02",
    koi_depth_err1: "4.410e+01",
    koi_depth_err2: "-4.410e+01",
    koi_prad: 1.3,
    koi_prad_err1: 7.0e-2,
    koi_prad_err2: "-5.000e-02",
    koi_teq: "241.0",
    koi_teq_err1: "",
    koi_teq_err2: "",
    koi_insol: 0.79,
    koi_insol_err1: "0.15",
    koi_insol_err2: "-0.11",
    koi_model_snr: "13.10",
    koi_tce_plnt_num: "1",
    koi_tce_delivname: "q1_q17_dr25_tce",
    koi_steff: "4401.00",
    koi_steff_err1: "78.00",
    koi_steff_err2: "-78.00",
    koi_slogg: "4.677",
    koi_slogg_err1: "0.017",
    koi_slogg_err2: "-0.027",
    koi_srad: "0.5950",
    koi_srad_err1: "0.0300",
    koi_srad_err2: "-0.0240",
    ra: "285.366580",
    dec: "39.280079",
    koi_kepmag: "14.976",
  },
  {
    kepid: 11497958,
    kepoi_name: "K01422.05",
    kepler_name: "Kepler-296 e",
    koi_disposition: "CONFIRMED",
    koi_pdisposition: "CANDIDATE",
    koi_score: 0.984,
    koi_fpflag_nt: 0,
    koi_fpflag_ss: 0,
    koi_fpflag_co: 0,
    koi_fpflag_ec: 0,
    koi_period: 34.1420506,
    koi_period_err1: 2.289e-4,
    koi_period_err2: -2.289e-4,
    koi_time0bk: 136.03624,
    koi_time0bk_err1: 5.59e-3,
    koi_time0bk_err2: -5.59e-3,
    koi_impact: 0.105,
    koi_impact_err1: 0.334,
    koi_impact_err2: -0.105,
    koi_duration: 2.945,
    koi_duration_err1: 0.179,
    koi_duration_err2: -0.179,
    koi_depth: "7.8800e+02",
    koi_depth_err1: "6.310e+01",
    koi_depth_err2: "-6.310e+01",
    koi_prad: 1.06,
    koi_prad_err1: 1.3e-1,
    koi_prad_err2: "-1.600e-01",
    koi_teq: "248.0",
    koi_teq_err1: "",
    koi_teq_err2: "",
    koi_insol: 0.89,
    koi_insol_err1: "0.33",
    koi_insol_err2: "-0.30",
    koi_model_snr: "13.30",
    koi_tce_plnt_num: "4",
    koi_tce_delivname: "q1_q17_dr25_tce",
    koi_steff: "3526.00",
    koi_steff_err1: "71.00",
    koi_steff_err2: "-78.00",
    koi_slogg: "4.866",
    koi_slogg_err1: "0.066",
    koi_slogg_err2: "-0.044",
    koi_srad: "0.3830",
    koi_srad_err1: "0.0480",
    koi_srad_err2: "-0.0580",
    ra: "286.540010",
    dec: "49.437328",
    koi_kepmag: "15.921",
  },
  {
    kepid: 6444896,
    kepoi_name: "K03138.01",
    kepler_name: "Kepler-1649 b",
    koi_disposition: "CONFIRMED",
    koi_pdisposition: "CANDIDATE",
    koi_score: 1.0,
    koi_fpflag_nt: 0,
    koi_fpflag_ss: 0,
    koi_fpflag_co: 0,
    koi_fpflag_ec: 0,
    koi_period: 8.68910764,
    koi_period_err1: 3.364e-5,
    koi_period_err2: -3.364e-5,
    koi_time0bk: 133.23559,
    koi_time0bk_err1: 3.88e-3,
    koi_time0bk_err2: -3.88e-3,
    koi_impact: 0.049,
    koi_impact_err1: 0.417,
    koi_impact_err2: -0.049,
    koi_duration: 1.1627,
    koi_duration_err1: 0.0951,
    koi_duration_err2: -0.0951,
    koi_depth: "1.6790e+03",
    koi_depth_err1: "1.340e+02",
    koi_depth_err2: "-1.340e+02",
    koi_prad: 0.49,
    koi_prad_err1: 0.0,
    koi_prad_err2: "0.000e+00",
    koi_teq: "211.0",
    koi_teq_err1: "",
    koi_teq_err2: "",
    koi_insol: 0.47,
    koi_insol_err1: "0.00",
    koi_insol_err2: "0.00",
    koi_model_snr: "9.60",
    koi_tce_plnt_num: "1",
    koi_tce_delivname: "q1_q17_dr25_tce",
    koi_steff: "2703.00",
    koi_steff_err1: "0.00",
    koi_steff_err2: "0.00",
    koi_slogg: "5.274",
    koi_slogg_err1: "0.000",
    koi_slogg_err2: "0.000",
    koi_srad: "0.1180",
    koi_srad_err1: "0.0000",
    koi_srad_err2: "0.0000",
    ra: "292.503780",
    dec: "41.830421",
    koi_kepmag: "17.131",
  },
  {
    kepid: 9002278,
    kepoi_name: "K00701.04",
    kepler_name: "Kepler-62 f",
    koi_disposition: "CONFIRMED",
    koi_pdisposition: "CANDIDATE",
    koi_score: 0.0,
    koi_fpflag_nt: 0,
    koi_fpflag_ss: 0,
    koi_fpflag_co: 0,
    koi_fpflag_ec: 0,
    koi_period: 267.282521,
    koi_period_err1: 4.81e-3,
    koi_period_err2: -4.81e-3,
    koi_time0bk: 589.71975,
    koi_time0bk_err1: 9.16e-3,
    koi_time0bk_err2: -9.16e-3,
    koi_impact: 0.378,
    koi_impact_err1: 0.092,
    koi_impact_err2: -0.378,
    koi_duration: 7.788,
    koi_duration_err1: 0.374,
    koi_duration_err2: -0.374,
    koi_depth: "4.7190e+02",
    koi_depth_err1: "2.690e+01",
    koi_depth_err2: "-2.690e+01",
    koi_prad: 1.43,
    koi_prad_err1: 8.0e-2,
    koi_prad_err2: "-6.000e-02",
    koi_teq: "207.0",
    koi_teq_err1: "",
    koi_teq_err2: "",
    koi_insol: 0.44,
    koi_insol_err1: "0.09",
    koi_insol_err2: "-0.07",
    koi_model_snr: "19.30",
    koi_tce_plnt_num: "4",
    koi_tce_delivname: "q1_q17_dr25_tce",
    koi_steff: "4926.00",
    koi_steff_err1: "98.00",
    koi_steff_err2: "-98.00",
    koi_slogg: "4.653",
    koi_slogg_err1: "0.017",
    koi_slogg_err2: "-0.049",
    koi_srad: "0.6620",
    koi_srad_err1: "0.0410",
    koi_srad_err2: "-0.0270",
    ra: "283.212740",
    dec: "45.349861",
    koi_kepmag: "13.725",
  },
  {
    kepid: 8311864,
    kepoi_name: "K07016.01",
    kepler_name: "Kepler-452 b",
    koi_disposition: "CONFIRMED",
    koi_pdisposition: "CANDIDATE",
    koi_score: 0.771,
    koi_fpflag_nt: 0,
    koi_fpflag_ss: 0,
    koi_fpflag_co: 0,
    koi_fpflag_ec: 0,
    koi_period: 384.847556,
    koi_period_err1: 7.105e-3,
    koi_period_err2: -7.105e-3,
    koi_time0bk: 314.97,
    koi_time0bk_err1: 1.52e-2,
    koi_time0bk_err2: -1.52e-2,
    koi_impact: 0.059,
    koi_impact_err1: 0.387,
    koi_impact_err2: -0.059,
    koi_duration: 9.969,
    koi_duration_err1: 0.441,
    koi_duration_err2: -0.441,
    koi_depth: "1.8990e+02",
    koi_depth_err1: "1.760e+01",
    koi_depth_err2: "-1.760e+01",
    koi_prad: 1.09,
    koi_prad_err1: 2.0e-1,
    koi_prad_err2: "-1.000e-01",
    koi_teq: "220.0",
    koi_teq_err1: "",
    koi_teq_err2: "",
    koi_insol: 0.56,
    koi_insol_err1: "0.32",
    koi_insol_err2: "-0.15",
    koi_model_snr: "12.30",
    koi_tce_plnt_num: "1",
    koi_tce_delivname: "q1_q17_dr25_tce",
    koi_steff: "5579.00",
    koi_steff_err1: "150.00",
    koi_steff_err2: "-150.00",
    koi_slogg: "4.580",
    koi_slogg_err1: "0.034",
    koi_slogg_err2: "-0.127",
    koi_srad: "0.7980",
    koi_srad_err1: "0.1500",
    koi_srad_err2: "-0.0750",
    ra: "296.003690",
    dec: "44.277561",
    koi_kepmag: "13.426",
  },
];

function isHabitable(planet: PlanetDataType) {
  return (
    planet["koi_disposition"] === "CONFIRMED" &&
    planet["koi_insol"] > 0.36 &&
    planet["koi_insol"] < 1.11 &&
    planet["koi_prad"] < 1.6
  );
}

export async function loadPlanetsData() {
  return await new Promise<void>(
    (resolve: () => void, reject: (error: unknown) => void) => {
      fs.createReadStream(
        path.join(__dirname, "..", "..", "..", "..", "data", "KeplerData.csv")
      )
        .pipe(
          parse({
            comment: "#",
            columns: true,
          })
        )
        .on("data", (data: PlanetDataType) => {
          if (isHabitable(data)) {
            habitablePlanets.push(data);
          }
        })
        .on("error", (error: unknown) => {
          console.log(error);
          reject(error);
        })
        .on("end", () => {
          console.log(
            `${habitablePlanets.length} number of habitable planets found`
          );
          resolve();
        });
    }
  );
}
